<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>PhotoShop--RGB色相&amp;饱和度&amp;明度函数模拟 | Wootau's blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PhotoShop--RGB色相&amp;饱和度&amp;明度函数模拟</h1><a id="logo" href="/.">Wootau's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">PhotoShop--RGB色相&amp;饱和度&amp;明度函数模拟</h1><div class="post-meta">Aug 2, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>objective-c学习中，遇到习题要求为绘画app增加调色板功能。涉及RGB色彩运算，我便想实现平日使用最多的<code>Ctrl + U</code>功能。<br>最终效果如下：<br><img src="http://ob9hppsg4.bkt.clouddn.com/ColorDisk.gif" alt="wootau colorDisk"><br><a id="more"></a> </p>
<h2 id="色相"><a href="#色相" class="headerlink" title="色相"></a>色相</h2><p>photoshop中RGB色彩色相计算通过保持三通道中最大与最小值不变，递增｜递减中间值达到保持灰度明度的情况下的色相改变。<br>伪代码：<br><figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">R = <span class="number">210</span>; G = <span class="number">140</span>; B = <span class="number">70</span>;  </div><div class="line"><span class="keyword">if</span> (translation &gt; <span class="number">0</span>) G += translation, G &lt;= R;  </div><div class="line"><span class="keyword">if</span> (translation &lt; <span class="number">0</span>) G += translation, G &gt; B;  </div><div class="line">G must satisfy R &gt;= G &gt; B;</div></pre></td></tr></table></figure></p>
<p>即中间值于变化中须满足<br><code>max &gt;= middle &gt; min</code></p>
<p>注意该处max处使用<code>=</code>，这是因为中间值在成为最大｜最小值后，将进入下一个循环，下一个循环中，另一通道色彩成为新的中间值，继续进行增减运算。<br>条件<code>R &gt;= G &gt; B</code>处<code>=</code>表示上一阶段G为max值，R在该阶段趋近G，直至<code>R = G</code>时R取代G成为新的max值，进入R循环。   </p>
<hr>
<p><strong>具体变化规律如下</strong>  </p>
<p>正向位移：  </p>
<table>
<thead>
<tr>
<th style="text-align:center">R = max</th>
<th style="text-align:center">G = max</th>
<th style="text-align:center">B = max</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">if(G &gt; B)</td>
<td style="text-align:center">if(B &gt; R)</td>
<td style="text-align:center">if(R &gt; G)</td>
</tr>
<tr>
<td style="text-align:center">G -&gt; B</td>
<td style="text-align:center">B -&gt; R</td>
<td style="text-align:center">R -&gt; G</td>
</tr>
<tr>
<td style="text-align:center">if(G &lt;= B)</td>
<td style="text-align:center">if(B &lt;= R)</td>
<td style="text-align:center">if(R &lt;= G</td>
</tr>
<tr>
<td style="text-align:center">B -&gt; R</td>
<td style="text-align:center">R -&gt; G</td>
<td style="text-align:center">G -&gt; B</td>
</tr>
</tbody>
</table>
<p>负向位移：  </p>
<table>
<thead>
<tr>
<th style="text-align:center">R = max</th>
<th style="text-align:center">G = max</th>
<th style="text-align:center">B = max</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">if(B &gt; G)</td>
<td style="text-align:center">if(R &gt; B)</td>
<td style="text-align:center">if(G &gt; R)</td>
</tr>
<tr>
<td style="text-align:center">B -&gt; G</td>
<td style="text-align:center">R -&gt; B</td>
<td style="text-align:center">G -&gt; R</td>
</tr>
<tr>
<td style="text-align:center">if(B &lt;= G)</td>
<td style="text-align:center">if(R &lt;= B)</td>
<td style="text-align:center">if(G &lt;= R)</td>
</tr>
<tr>
<td style="text-align:center">G -&gt; R</td>
<td style="text-align:center">B -&gt; G</td>
<td style="text-align:center">R -&gt; B</td>
</tr>
</tbody>
</table>
<p>如表所示，单向位移共有3个大循环，每个由2个小循环组成。大循环分别代表R，G，B的峰值，每个大循环中将完成另2个色彩的交替。6个循环完成，最终色彩将回归原值。  </p>
<p><strong>在实际使用中，色相按钮的位移很可能在单次刷新时间中远超1/6总距离</strong><br>于是需要使用循环函数，可将过大translation分段计算，确保用户高速运动下的正确运算：</p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (colorDistances &gt; <span class="number">0</span>) &#123;...&#125;</div><div class="line"><span class="keyword">while</span> (colorDistances &lt; <span class="number">0</span>) &#123;...&#125;</div></pre></td></tr></table></figure>
<p>每个小循环将逐步削减colorDistances值，仅当colorDistances为0时，循环停止。</p>
<h2 id="饱和度"><a href="#饱和度" class="headerlink" title="饱和度"></a>饱和度</h2><p>以下是一些RGB转灰度空间的算法</p>
<blockquote>
<p>1、简化 sRGB IEC61966-2.1 [gamma=2.20]<br>Gray = (R^2.2 * 0.2126  + G^2.2 * 0.7152  + B^2.2 * 0.0722)^(1/2.2)  </p>
<p>2、 Adobe RGB (1998) [gamma=2.20]<br>Gray = (R^2.2 * 0.2973  + G^2.2 * 0.6274  + B^2.2 * 0.0753)^(1/2.2)  </p>
<p>3、Apple RGB [gamma=1.80]<br>Gray = (R^1.8 * 0.2446  + G^1.8 * 0.6720  + B^1.8 * 0.0833)^(1/1.8)  </p>
<p>4、ColorMatch RGB [gamma=1.8]<br>Gray = (R^1.8 * 0.2750  + G^1.8 * 0.6581  + B^1.8 * 0.0670)^(1/1.8)  </p>
<p>5、简化 KODAK DC Series Digital Camera [gamma=2.2]<br>Gray = (R^2.2 * 0.2229  + G^2.2 * 0.7175  + B^2.2 * 0.0595)^(1/2.2)  </p>
</blockquote>
<p>在实现<code>Ctrl + U</code>功能的饱和度&amp;灰度算法中，无须使用以上的复杂公式。该功能基于用户最初载入的颜色计算，必须保证无论如何更改色相，灰度均以最初颜色为准，即不同色相需得出相同的灰色。为实现该需求，需要找出色相变化过程中各个颜色间的共同点，以此计算共同的灰度。  </p>
<p><strong>在色相运算中，颜色间始终有两个值保持不变，即最大与最小值。无论RGB于循环中如何大小交替，初始颜色的max&amp;min值不会改变。</strong><br>于是可以借此得到所有色相的共同灰度：</p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Gray = (max + min) / <span class="number">2</span>; </div><div class="line">VR : VG : VB = (R - gray) : (G - gray) : (B - gray);</div></pre></td></tr></table></figure>
<p>当<code>translation &lt; 0</code>时，R，G，B值分别向Gray靠拢。<br>RGB三色保持相同速率比变化，趋近Gray，能够保持色相不发生改变。</p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GR = R + grayDistances * (R - gray) / lenth * <span class="number">2</span>;</div></pre></td></tr></table></figure>
<p>当<code>translation &gt; 0</code>时，如何求出RGB三通道于增大饱和度过程中应达到的最大或最小值，并保证色相不发生改变，是该段最主要的问题。  </p>
<p>首先，需要借用上过程中的速率比。保持该速率比，反向运算，可保持色相不变。<br>其次，判断max与min谁先达到极值（0－255，UIColor对应0-1），达到极值代表该颜色已达到最大饱和度。该极值对应translation最大值。<br><figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>((<span class="number">1</span> - max) / (max - gray) &lt;= min / (gray - min)) &#123;</div><div class="line">    GR = R + grayDistances * (<span class="number">1</span> - max) * (R - gray) </div><div class="line">    / (max - gray) / lenth * <span class="number">2</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    GR = R + grayDistances * min * (R - gray)</div><div class="line">    / (gray - min) / lenth * <span class="number">2</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><small>若min首先到达0，max未达255，此时max不可增加，饱和度未达100％。但该饱和度已是最大饱和度，继续增加max将导致min成为负值。</small><br>该式判断max与min谁先到达极值，并基于该判断进入max或min分支计算。<br>以max或min优先达到极值的作为基准运算，保持速率比，在达到极值时，对应的色彩即达到最大饱和度。  </p>
<h2 id="明度"><a href="#明度" class="headerlink" title="明度"></a>明度</h2><p>明度计算与饱和度计算有共通之处，均须达到两个极值。区别在于饱和度的极值为最灰与最艳，而明度为<br><code>(0, 0, 0) - (255, 255, 255)</code><br>理解了饱和度的计算方式，明度的计算更加简单：  </p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (lightDistences &lt; <span class="number">0</span>) &#123;  </div><div class="line">    LR = GR + lightDistences * GR / lenth * <span class="number">2</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    LR = GR + lightDistences * (<span class="number">1</span> - GR) / lenth * <span class="number">2</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>经过该运算，即得最终所求颜色。 </p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>该算法的核心思想在于始终通过用户选定的初始值进行运算，在用户关闭调色板保存该UIColor前，始终通过该值作为中心，分别进行色相&amp;饱和度&amp;明度的三次运算，得到最终变换完成的颜色。事实上，即便每次操作只操作一个操作条，运算仍将进行三次，但用户不会感觉出来。<br>如果每次操作一个操作条，便刷新一次距离与色彩，用translation作为累加值  </p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[gr setTranslation: <span class="built_in">CGPointZero</span> inView: <span class="keyword">self</span>];</div></pre></td></tr></table></figure>
<p>那将是庞大的计算，我以该方法出发，勉强实现了目标，却因误差太大不得不放弃，此时代码可谓臃肿不堪。<br>重新审视出发点，最终得到了目前的方法。</p>
<p>代码如下：  </p>
<figure class="highlight mm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//photoShop色相&amp;饱和度&amp;明度算法</span></div><div class="line"><span class="comment">//uiColor为指定修改的对象，不能将其作为方法返回值的接受者</span></div><div class="line"><span class="comment">//colorChange为色相相对于中心的偏移</span></div><div class="line"><span class="comment">//grayChange为灰度相对于中心的偏移</span></div><div class="line"><span class="comment">//lightChange为明度相对于中心的偏移</span></div><div class="line"><span class="comment">//totalDistLenth为滑条总长度</span></div><div class="line"><span class="comment">//返回修改后的UIColor</span></div><div class="line"></div><div class="line"><span class="meta">#define UIColor(R, G, B) [UIColor colorWithRed: (R) green: (G) blue: (B) alpha: 1.0]</span></div><div class="line"><span class="meta">#define THREEMAX(R, G, B) (((R) &gt;= (G) ? (R) : (G)) &gt;= ((R) &gt;= (B) ? (R) : (B)) ? ((R) &gt;= (G) ? (R) : (G)) : ((R) &gt;= (B) ? (R) : (B)))</span></div><div class="line"><span class="meta">#define THREEMIN(R, G, B) (((R) <span class="meta-string">&lt;= (G) ? (R) : (G)) &lt;= ((R) &lt;= (B) ? (R) : (B)) ? ((R) &lt;= (G) ? (R) : (G)) : ((R) &lt;= (B) ? (R) : (B)))</span></span></div><div class="line">#define GRAY(R, G, B) ((THREEMAX((R), (G), (B)) + THREEMIN((R), (G), (B))) / 2)</div><div class="line"></div><div class="line">- (UIColor *)colorChange: (float)colorDistances grayChange: (float)grayDistances</div><div class="line">                                               lightChange: (float)lightDistences</div><div class="line">                                            totalDistLenth: (float)lenth</div><div class="line">                                                   uiColor: (UIColor *)color</div><div class="line">&#123;</div><div class="line">    float R, G, B;</div><div class="line">    [color getRed: &amp;R green: &amp;G blue: &amp;B alpha: nil];</div><div class="line">    float dValue = THREEMAX(R, G, B) - THREEMIN(R, G, B);</div><div class="line">    </div><div class="line">    while (colorDistances &gt; 0) &#123;</div><div class="line">        <span class="keyword">if</span> (R &gt;= G &amp;&amp; R &gt; B) &#123;</div><div class="line">            <span class="keyword">if</span> (G &gt; B) &#123;</div><div class="line">                <span class="keyword">if</span> (G - colorDistances * dValue * <span class="number">6</span> / lenth &gt;= B) &#123;</div><div class="line">                    G -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -= (G - B) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    G = B;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (G &lt;= B) &#123;</div><div class="line">                <span class="keyword">if</span> (B + colorDistances * dValue * <span class="number">6</span> / lenth &lt;= R) &#123;</div><div class="line">                    B += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -= (R - B) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    B = R;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (B &gt;= R &amp;&amp; B &gt; G) &#123;</div><div class="line">            <span class="keyword">if</span> (R &gt; G) &#123;</div><div class="line">                <span class="keyword">if</span> (R - colorDistances * dValue * <span class="number">6</span> / lenth &gt;= G) &#123;</div><div class="line">                    R -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -=  (R - G) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    R = G;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (R &lt;= G) &#123;</div><div class="line">                <span class="keyword">if</span> (G + colorDistances * dValue * <span class="number">6</span> / lenth &lt;= B) &#123;</div><div class="line">                    G += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -= (B - G) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    G = B;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (G &gt;= B &amp;&amp; G &gt; R) &#123;</div><div class="line">            <span class="keyword">if</span> (B &gt; R) &#123;</div><div class="line">                <span class="keyword">if</span> (B - colorDistances * dValue * <span class="number">6</span> / lenth &gt;= R) &#123;</div><div class="line">                    B -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -= (B - R) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    B = R;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (B &lt;= R) &#123;</div><div class="line">                <span class="keyword">if</span> (R + colorDistances * dValue * <span class="number">6</span> / lenth &lt;= G) &#123;</div><div class="line">                    R += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances -= (G - R) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    R = G;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span> (colorDistances &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (R &gt; G &amp;&amp; R &gt;= B) &#123;</div><div class="line">            <span class="keyword">if</span> (B &gt; G) &#123;</div><div class="line">                <span class="keyword">if</span> (B + colorDistances * dValue * <span class="number">6</span> / lenth &gt;= G) &#123;</div><div class="line">                    B += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances += (B - G) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    B = G;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (B &lt;= G) &#123;</div><div class="line">                <span class="keyword">if</span> (G - colorDistances * dValue * <span class="number">6</span> / lenth &lt;= R) &#123;</div><div class="line">                    G -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances += (R - G) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    G = R;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (B &gt; R &amp;&amp; B &gt;= G) &#123;</div><div class="line">            <span class="keyword">if</span> (G &gt; R) &#123;</div><div class="line">                <span class="keyword">if</span> (G + colorDistances * dValue * <span class="number">6</span> / lenth &gt;= R) &#123;</div><div class="line">                    G += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances +=  (G - R) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    G = R;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (G &lt;= R) &#123;</div><div class="line">                <span class="keyword">if</span> (R - colorDistances * dValue * <span class="number">6</span> / lenth &lt;= B) &#123;</div><div class="line">                    R -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances += (B - R) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    R = B;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (G &gt; B &amp;&amp; G &gt;= R) &#123;</div><div class="line">            <span class="keyword">if</span> (R &gt; B) &#123;</div><div class="line">                <span class="keyword">if</span> (R + colorDistances * dValue * <span class="number">6</span> / lenth &gt;= B) &#123;</div><div class="line">                    R += colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances += (R - B) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    R = B;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (R &lt;= B) &#123;</div><div class="line">                <span class="keyword">if</span> (B - colorDistances * dValue * <span class="number">6</span> / lenth &lt;= G) &#123;</div><div class="line">                    B -= colorDistances * dValue * <span class="number">6</span> / lenth;</div><div class="line">                    colorDistances = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    colorDistances += (G - B) / dValue * lenth / <span class="number">6</span>;</div><div class="line">                    B = G;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">float</span> GR, GG, GB;</div><div class="line">    GR = R; GG = G; GB = B;</div><div class="line">    <span class="keyword">if</span> (grayDistances != <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">float</span> gray = GRAY(R, G, B);</div><div class="line">        <span class="keyword">float</span> max = THREEMAX(R, G, B);</div><div class="line">        <span class="keyword">float</span> min = THREEMIN(R, G, B);</div><div class="line">        <span class="keyword">if</span> (grayDistances &lt; <span class="number">0</span>) &#123;</div><div class="line">            GR = R + grayDistances * (R - gray) / lenth * <span class="number">2</span>;</div><div class="line">            GG = G + grayDistances * (G - gray) / lenth * <span class="number">2</span>;</div><div class="line">            GB = B + grayDistances * (B - gray) / lenth * <span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> ((<span class="number">1</span> - max) / (max - gray) &lt;= min / (gray - min)) &#123;</div><div class="line">                GR = R + grayDistances * (<span class="number">1</span> - max) * (R - gray) / (max - gray) / lenth * <span class="number">2</span>;</div><div class="line">                GG = G + grayDistances * (<span class="number">1</span> - max) * (G - gray) / (max - gray) / lenth * <span class="number">2</span>;</div><div class="line">                GB = B + grayDistances * (<span class="number">1</span> - max) * (B - gray) / (max - gray) / lenth * <span class="number">2</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                GR = R + grayDistances * min * (R - gray) / (gray - min) / lenth * <span class="number">2</span>;</div><div class="line">                GG = G + grayDistances * min * (G - gray) / (gray - min) / lenth * <span class="number">2</span>;</div><div class="line">                GB = B + grayDistances * min * (B - gray) / (gray - min) / lenth * <span class="number">2</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">float</span> LR, LG, LB;</div><div class="line">    LR = GR; LG = GG; LB = GB;</div><div class="line">    <span class="keyword">if</span> (lightDistences != <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (lightDistences &lt; <span class="number">0</span>) &#123;</div><div class="line">            LR = GR + lightDistences * GR / lenth * <span class="number">2</span>;</div><div class="line">            LG = GG + lightDistences * GG / lenth * <span class="number">2</span>;</div><div class="line">            LB = GB + lightDistences * GB / lenth * <span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            LR = GR + lightDistences * (<span class="number">1</span> - GR) / lenth * <span class="number">2</span>;</div><div class="line">            LG = GG + lightDistences * (<span class="number">1</span> - GG) / lenth * <span class="number">2</span>;</div><div class="line">            LB = GB + lightDistences * (<span class="number">1</span> - GB) / lenth * <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">UIColor</span> *changedColor = [<span class="built_in">UIColor</span> colorWithRed: LR green: LG blue: LB alpha: <span class="number">1.0</span>];</div><div class="line">    <span class="keyword">return</span> changedColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/08/02/PhotoShop-RGB色相-饱和度-明度函数模拟/" data-id="cisedym1p0000ygfysm70xg6k" class="article-share-link">Share</a><div class="tags"></div><div class="post-nav"><a href="/2016/08/20/UIImage-ImageEffects模糊滤镜理解/" class="pre">UIImage+ImageEffects模糊滤镜理解</a><a href="/2016/08/01/我的第一篇文章/" class="next">第一篇博文</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/08/24/UIDynamicAnimator学习笔记/">UIDynamicAnimator学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/UIImage-ImageEffects模糊滤镜理解/">UIImage+ImageEffects模糊滤镜理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/02/PhotoShop-RGB色相-饱和度-明度函数模拟/">PhotoShop--RGB色相&饱和度&明度函数模拟</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/我的第一篇文章/">第一篇博文</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Wootau's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>